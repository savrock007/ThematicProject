<?php

namespace App\Http\Controllers;


use App\Http\Resources\TicketResource;
use App\Models\Ticket;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Inertia\Inertia;
use Inertia\Response;


class VulnerabilityController extends Controller
{

    public function list(Request $request): Response
    {


        $s = $request->input('text');
        $date = Carbon::create($request->input('date'))?->format('Y-m-d');
        $status = $request->input('status');


        $vulns = Ticket::when($s, function ($query) use ($s) {
            $query->where('title', 'like', $s);
        })->when($date, function ($query) use ($date) {

            $query->where('created_at', '>', $date);
        })->when($status, function ($query) use ($status) {
            $query->where('status_id', $status);
        })->get();


        return Inertia::render('VulnList', [
            'vulns' => TicketResource::collection($vulns)
        ]);
    }


    public function details(Request $request, int $id): Response
    {

        $ticket = Ticket::find($id);
        return Inertia::render('VulnDetails', [
            'vuln' => new TicketResource($ticket)
        ]);


    }


}
